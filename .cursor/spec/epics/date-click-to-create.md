# 날짜 클릭으로 일정 생성 기능

## 요약 (Summary)

캘린더의 비어있는 날짜 셀을 클릭하면 해당 날짜가 자동으로 일정 추가 폼의 날짜 필드에 채워집니다. 월 뷰와 주 뷰 모두에서 동작하며, 드래그 앤 드롭 기능과 충돌하지 않습니다.

## 배경 (Background)

현재 사용자는 일정을 추가하려면 먼저 폼의 날짜 입력 필드를 직접 입력하거나 달력 선택기를 열어야 합니다. 이는 불편하고 직관적이지 않습니다. 캘린더에서 날짜를 클릭하면 바로 해당 날짜로 일정을 생성할 수 있도록 하여 사용자 경험을 개선합니다.

## 목표 (Goals)

1. 캘린더의 비어있는 날짜 셀 클릭 시 해당 날짜가 폼에 자동 채워지도록 구현
2. 월 뷰와 주 뷰 모두에서 동작
3. 드래그 앤 드롭 기능과 충돌하지 않도록 처리
4. 편집 모드가 아닐 때만 동작 (새 일정 추가 모드)

## 목표가 아닌 것 (Non-Goals)

- 날짜 셀 클릭 시 폼 전체를 자동으로 열거나 표시하는 기능
- 날짜 셀 클릭 시 기본 시간값 자동 설정
- 날짜 셀 클릭 시 모달이나 다이얼로그 표시
- 이벤트가 있는 날짜 셀 클릭 시 특별한 동작 (기존 동작 유지)

## 계획 (Plan)

### 예상 동작 (Expected Behaviors)

#### 1. 월 뷰에서 비어있는 날짜 셀 클릭

**동작 명세**:

- 월 뷰에서 이벤트가 없는 날짜 셀을 클릭하면 해당 날짜가 폼의 날짜 필드에 자동으로 채워집니다.
- 날짜 형식은 `YYYY-MM-DD`입니다.
- 편집 모드가 아닐 때만 동작합니다.

**검증 포인트**:

```
Given: 월 뷰에서 2024-01-15 날짜 셀 (이벤트 없음)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드에 "2024-01-15"가 자동으로 채워짐

Given: 월 뷰에서 2024-02-29 날짜 셀 (이벤트 없음, 윤년)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드에 "2024-02-29"가 자동으로 채워짐

Given: 월 뷰에서 현재 월이 아닌 다른 월의 날짜 셀 (예: 이전 달의 마지막 날짜)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드에 해당 날짜가 정확히 채워짐 (예: "2023-12-31")
```

#### 2. 주 뷰에서 비어있는 날짜 셀 클릭

**동작 명세**:

- 주 뷰에서 이벤트가 없는 날짜 셀을 클릭하면 해당 날짜가 폼의 날짜 필드에 자동으로 채워집니다.
- 날짜 형식은 `YYYY-MM-DD`입니다.
- 편집 모드가 아닐 때만 동작합니다.

**검증 포인트**:

```
Given: 주 뷰에서 2024-01-15 날짜 셀 (이벤트 없음)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드에 "2024-01-15"가 자동으로 채워짐

Given: 주 뷰에서 주말 날짜 셀 (2024-01-20, 토요일, 이벤트 없음)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드에 "2024-01-20"가 자동으로 채워짐
```

#### 3. 빈 셀 클릭 (null 날짜)

**동작 명세**:

- 월 뷰에서 빈 셀(null 값)을 클릭해도 아무 동작도 하지 않습니다.
- 이는 이전 달이나 다음 달의 날짜가 아닌 완전히 빈 공간입니다.

**검증 포인트**:

```
Given: 월 뷰에서 빈 셀 (day === null)
When: 해당 셀을 클릭
Then: 폼의 날짜 필드가 변경되지 않음
```

#### 4. 편집 모드에서 날짜 셀 클릭

**동작 명세**:

- 일정을 편집 중일 때(`editingEvent`가 존재할 때) 날짜 셀을 클릭해도 날짜가 변경되지 않습니다.
- 편집 중인 일정의 날짜는 사용자가 직접 수정해야 합니다.

**검증 포인트**:

```
Given: 일정 수정 모드 (editingEvent가 존재)
When: 비어있는 날짜 셀을 클릭
Then: 폼의 날짜 필드가 변경되지 않음
Then: 편집 중인 일정의 날짜가 유지됨
```

#### 5. 이벤트가 있는 날짜 셀 클릭

**동작 명세**:

- 이벤트가 있는 날짜 셀을 클릭하면 날짜가 채워지지 않습니다.
- 이벤트 박스가 있는 경우 드래그 앤 드롭이 우선 동작합니다.
- 셀의 빈 공간(이벤트 박스가 없는 영역)을 클릭하면 날짜가 채워집니다.

**검증 포인트**:

```
Given: 월 뷰에서 2024-01-15 날짜 셀 (이벤트 1개 존재)
When: 이벤트 박스를 클릭
Then: 폼의 날짜 필드가 변경되지 않음 (기존 동작 유지)

Given: 월 뷰에서 2024-01-15 날짜 셀 (이벤트 1개 존재, 셀에 빈 공간 있음)
When: 셀의 빈 공간을 클릭 (이벤트 박스가 아닌 영역)
Then: 폼의 날짜 필드에 "2024-01-15"가 자동으로 채워짐
```

#### 6. 드래그 앤 드롭과의 충돌 방지

**동작 명세**:

- 드래그 앤 드롭 중에는 날짜 셀 클릭이 동작하지 않습니다.
- 드래그가 시작되면 클릭 이벤트가 무시됩니다.

**검증 포인트**:

```
Given: 이벤트를 드래그 중
When: 비어있는 날짜 셀을 클릭 (실제로는 드롭)
Then: 드래그 앤 드롭 동작이 우선 처리됨
Then: 날짜 자동 채우기 동작이 실행되지 않음
```

### 기술 요구사항

#### 1. 데이터 타입

기존 타입을 그대로 사용합니다:

```typescript
// types.ts
interface EventForm {
  date: string; // YYYY-MM-DD 형식
  // ... 기타 필드
}

// useEventForm.ts
const [date, setDate] = useState<string>('');
```

#### 2. 날짜 형식 규칙

- 입력 형식: `YYYY-MM-DD` (예: `2024-01-15`)
- `formatDate` 유틸 함수 사용:
  ```typescript
  formatDate(currentDate: Date, day?: number): string
  ```
- 월 뷰: `formatDate(currentDate, day)` - `day`는 1-31 사이의 숫자
- 주 뷰: `formatDate(date)` - `date`는 Date 객체

#### 3. 클릭 이벤트 핸들러

**월 뷰**:

```typescript
const handleDateCellClick = (dateString: string, day: number | null) => {
  // 편집 모드가 아니고, 유효한 날짜인 경우에만 처리
  if (!editingEvent && day !== null && dateString) {
    setDate(dateString);
  }
};
```

**주 뷰**:

```typescript
const handleDateCellClick = (dateString: string) => {
  // 편집 모드가 아니고, 유효한 날짜인 경우에만 처리
  if (!editingEvent && dateString) {
    setDate(dateString);
  }
};
```

#### 4. 이벤트 버블링 처리

- 이벤트 박스를 클릭한 경우 이벤트가 버블링되지 않도록 처리
- 셀의 빈 공간을 클릭한 경우에만 날짜 채우기 동작 수행

#### 5. 드래그 앤 드롭과의 충돌 방지

- `onClick` 이벤트 핸들러에서 드래그 상태 확인
- 드래그가 시작된 경우 클릭 이벤트 무시
- 또는 `mousedown`과 `mouseup` 시간 차이로 드래그와 클릭 구분

### 제약사항 및 에지 케이스

| 입력값                          | 예상 동작   | 비고                                  |
| ------------------------------- | ----------- | ------------------------------------- |
| 빈 셀 (날짜가 null)             | 동작 없음   | 이전/다음 달 날짜가 아닌 완전히 빈 셀 |
| 이벤트가 있는 셀의 빈 공간 클릭 | 날짜 채워짐 | 이벤트 박스가 아닌 영역               |
| 이벤트 박스 클릭                | 동작 없음   | 기존 동작 유지                        |
| 편집 모드 중 셀 클릭            | 동작 없음   | `editingEvent`가 존재할 때            |
| 드래그 중 셀 클릭               | 동작 없음   | 드래그 앤 드롭 우선                   |
| 이전 달 날짜 셀 클릭            | 날짜 채워짐 | 예: 현재 2024-01인데 2023-12-31 클릭  |
| 다음 달 날짜 셀 클릭            | 날짜 채워짐 | 예: 현재 2024-01인데 2024-02-01 클릭  |
| 윤년 2월 29일 클릭              | 날짜 채워짐 | "2024-02-29" 형식으로 저장            |

### 구현 우선순위

1. **높음**:

   - 월 뷰에서 비어있는 날짜 셀 클릭 시 날짜 채우기
   - 주 뷰에서 비어있는 날짜 셀 클릭 시 날짜 채우기
   - 편집 모드 체크

2. **중간**:

   - 이벤트가 있는 셀의 빈 공간 클릭 처리
   - 빈 셀(null) 클릭 무시

3. **낮음**:
   - 드래그 앤 드롭과의 충돌 방지 최적화
   - 클릭 시각적 피드백 (선택사항)

## 기존 코드베이스 연관성

### 관련 파일

1. **`src/App.tsx`**:

   - `renderMonthView()`: 월 뷰 렌더링 함수
   - `renderWeekView()`: 주 뷰 렌더링 함수
   - `TableCell` 컴포넌트에 클릭 핸들러 추가 필요
   - `useEventForm` 훅의 `setDate` 함수 사용

2. **`src/hooks/useEventForm.ts`**:

   - `date`, `setDate` 상태 관리
   - `editingEvent` 상태 확인

3. **`src/utils/dateUtils.ts`**:

   - `formatDate()`: 날짜 포맷팅 함수 사용
   - `getEventsForDay()`: 특정 날짜의 이벤트 확인

4. **`src/types.ts`**:
   - `Event` 타입의 `date` 필드 (변경 없음)

### 영향 받는 컴포넌트

- `App.tsx`의 `renderMonthView()` 함수
- `App.tsx`의 `renderWeekView()` 함수
- 날짜 셀 `TableCell` 컴포넌트

### 기존 기능과의 통합

- 드래그 앤 드롭 기능과 충돌하지 않도록 구현
- 기존 폼 검증 로직과 호환
- 기존 이벤트 클릭/드래그 동작 유지
