---
epic: drag-and-drop
test_suite: 다중 일정이 있는 셀에 드롭
---

# Story 6: 다중 일정이 있는 셀에 드롭

## 개요

이미 여러 일정이 존재하는 날짜 셀에 일정을 드롭해도 정상적으로 동작하는지 검증합니다.

## Epic 연결

- **Epic**: 드래그 앤 드롭(D&D) 일정 이동 기능
- **Epic 파일**: `.cursor/spec/epics/drag-and-drop.md`
- **검증 포인트**: Epic의 "예상 동작" 섹션 10번(다중 일정이 있는 셀에 드롭)에서 추출
- **우선순위**: 중간 (일반적인 케이스)

## 테스트 구조 및 범위

이 Story가 작성될 테스트 코드의 논리적 계층 구조를 명시합니다.

- **테스트 스위트 (Describe Block):** '다중 일정이 있는 셀에 드롭'
  - **테스트 케이스 1:** '2개의 일정이 있는 셀에 일정을 드롭하면 3개가 된다'
  - **테스트 케이스 2:** '드롭된 일정이 타겟 날짜의 일정 목록에 추가된다'
  - **테스트 케이스 3:** '드롭된 일정의 날짜가 타겟 날짜로 변경된다'
  - **테스트 케이스 4:** '기존 일정들은 영향을 받지 않는다'
  - **테스트 케이스 5:** '5개 이상의 일정이 있는 셀에도 정상적으로 드롭된다'
  - **테스트 케이스 6:** '드롭 후 모든 일정이 올바른 순서로 렌더링된다'

## 검증 포인트 (Given-When-Then)

### 검증 포인트 1: 다중 일정 셀에 드롭

```
Given: 2025-11-03에 "회의 A", "회의 B" 2개의 일정이 이미 존재
When: 2025-11-01의 "회의 C"를 2025-11-03로 드롭
Then: 2025-11-03에 3개의 일정이 표시됨
And: "회의 C"의 날짜가 2025-11-03로 변경됨
```

## 테스트 데이터

| 시나리오                  | 기존 일정 개수 | 기존 일정                                                                    | 드래그 일정               | 드롭 날짜  | 예상 일정 개수 | 비고                   |
| ------------------------- | -------------- | ---------------------------------------------------------------------------- | ------------------------- | ---------- | -------------- | ---------------------- |
| 2개 → 3개                 | 2              | "회의 A" (10:00-11:00), "회의 B" (14:00-15:00)                               | "회의 C" (12:00-13:00)    | 2025-11-03 | 3              | 중간 시간대 추가       |
| 1개 → 2개                 | 1              | "단독 회의" (10:00-11:00)                                                    | "추가 회의" (15:00-16:00) | 2025-11-03 | 2              | 겹치지 않는 시간       |
| 3개 → 4개                 | 3              | "회의 A" (09:00-10:00), "회의 B" (11:00-12:00), "회의 C" (14:00-15:00)       | "회의 D" (16:00-17:00)    | 2025-11-03 | 4              | 많은 일정              |
| 빈 셀 → 1개               | 0              | 없음                                                                         | "첫 회의" (10:00-11:00)   | 2025-11-03 | 1              | 빈 셀에 드롭           |
| 5개 → 6개                 | 5              | 5개의 일정 (09:00-10:00, 10:00-11:00, 11:00-12:00, 13:00-14:00, 14:00-15:00) | "회의 F" (15:00-16:00)    | 2025-11-03 | 6              | 많은 일정 처리         |
| 겹치는 시간대 추가        | 2              | "회의 A" (10:00-11:00), "회의 B" (14:00-15:00)                               | "회의 C" (10:30-11:30)    | 2025-11-03 | 3              | 겹침 경고 후 계속 진행 |
| 반복 일정이 있는 셀       | 1              | "매주 회의" (10:00-11:00, repeat: weekly)                                    | "일반 회의" (14:00-15:00) | 2025-11-03 | 2              | 반복 일정 + 일반 일정  |
| 카테고리가 다른 일정 추가 | 2              | "업무" 카테고리 2개                                                          | "개인" 카테고리 1개       | 2025-11-03 | 3              | 카테고리 혼합          |

## 기술 참고사항

### 관련 타입

```typescript
interface Event {
  id: string;
  title: string;
  date: string;
  startTime: string;
  endTime: string;
  description: string;
  location: string;
  category: string;
  repeat: RepeatInfo;
  notificationTime: number;
}
```

### 일정 목록 필터링

특정 날짜의 모든 일정을 가져오는 로직:

```typescript
const getEventsByDate = (events: Event[], date: string): Event[] => {
  return events.filter((event) => event.date === date);
};
```

### 일정 정렬

날짜 셀 내에서 일정을 시작 시간 순으로 정렬:

```typescript
const sortEventsByTime = (events: Event[]): Event[] => {
  return events.sort((a, b) => {
    return a.startTime.localeCompare(b.startTime);
  });
};
```

## 구현 참고사항

### useDragAndDrop 훅

`handleDrop` 함수는 다중 일정 처리를 위한 특별한 로직이 필요하지 않습니다:

- 기존 로직대로 날짜만 변경하여 저장
- 서버가 자동으로 해당 날짜의 일정 목록을 업데이트

### App.tsx 렌더링

날짜 셀에서 일정 목록을 렌더링할 때:

```typescript
const dateEvents = getEventsByDate(events, dateString);
const sortedEvents = sortEventsByTime(dateEvents);

sortedEvents.map(event => (
  <Box
    key={event.id}
    draggable
    onDragStart={() => handleDragStart(event)}
    // ... 일정 박스 렌더링
  />
));
```

### 일정 목록 UI

여러 일정이 표시될 때의 레이아웃:

- 세로로 스택 형태로 배치
- 각 일정 박스의 높이를 적절히 조정
- 스크롤이 필요한 경우 처리

### 에지 케이스 처리

- **많은 일정**: 5개 이상의 일정이 있을 때 UI가 깨지지 않도록 처리
- **겹치는 일정**: 겹침 경고 다이얼로그를 통해 사용자가 선택
- **반복 일정**: 반복 일정 다이얼로그를 통해 처리

## 예상 작업 시간

1시간

## 의존성

- Story 1 (드래그 시작 및 시각적 피드백) 완료 필요
- Story 2 (일반 일정 드롭) 완료 필요
- Story 3 (반복 일정 드롭) 완료 필요
- Story 4 (일정 겹침 감지) 완료 필요
- 일정 목록 렌더링 로직이 이미 구현되어 있어야 함
